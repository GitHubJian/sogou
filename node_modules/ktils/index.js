const glob = require('glob');
const { isAbsolute, resolve, basename } = require('path');
const root = process.cwd();

const echo = (path, pattern, ext) => {
    if (!pattern) {
        throw new Error('Arguments Pattern is Error');
    }

    if (!isAbsolute(path)) {
        path = resolve(root, path);
    }

    return glob.sync(resolve(path, pattern)).reduce((prev, cur) => {
        let filename = ext ? basename(cur, `.${ext}`) : basename(cur);
        let key = filename.replace(/\.(\w)/g, function(word) {
            return word.substring(1, 2).toUpperCase() + word.substring(2);
        });

        prev[key] = require(resolve(path, `./${filename}.js`));
        return prev;
    }, {});
};

module.exports = echo;
